#!/bin/bash

[[ ! -f "${DIR}/db.conf" ]] && >&2 echo "database server configuration file not found" && exit 1
source "${DIR}/db.conf"

[[ ! -f "${DIR}/app.conf" ]] && >&2 echo "application configuration file not found" && exit 1
source "${DIR}/app.conf"

APP_PRIVATE_ROOT="${APP_PRIVATE_ROOT:-"${ASSET}/www"}"

[[ ! -f "${APP_PRIVATE_ROOT}/backups/install.sql" ]] && echo "install file not found" >&2 && exit 2
[[ -z "$(docker ps -f 'name=^'"${DB_CONTAINER}"'$' -q)" ]] && echo "database container not started" >&2 && exit 3

docker cp ${APP_PRIVATE_ROOT}/backups/install.sql ${DB_CONTAINER}:/
db bash -c "cat /install.sql | mysql ${DB_NAME}"
db rm /install.sql
